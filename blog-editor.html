<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>SMI Blog Editor</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --void: #020408; --deep: #040c14; --navy: #061020;
  --electric: #00d4ff; --plasma: #0066ff; --gold: #f5c842;
  --white: #e8f4ff; --muted: #4a6080; --border: rgba(0,212,255,0.15);
  --success: #00ff88; --error: #ff4466;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body { font-family: 'DM Sans', sans-serif; background: var(--void); color: var(--white); min-height: 100vh; }

/* â”€â”€ SCREENS â”€â”€ */
.screen { display: none; min-height: 100vh; }
.screen.active { display: flex; }

/* â”€â”€ LOGIN â”€â”€ */
#loginScreen {
  align-items: center; justify-content: center;
  background: radial-gradient(ellipse at 30% 20%, rgba(0,100,255,0.12), transparent 60%),
              radial-gradient(ellipse at 70% 80%, rgba(0,212,255,0.08), transparent 60%);
}
.login-box {
  width: 100%; max-width: 440px; padding: 56px 48px;
  border: 1px solid var(--border); border-radius: 8px;
  background: rgba(4,12,20,0.8); backdrop-filter: blur(20px);
  margin: 20px;
}
.login-logo { display: flex; align-items: center; gap: 12px; margin-bottom: 40px; }
.login-logo img { height: 36px; }
.login-logo-text { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; line-height: 1.2; }
.login-logo-text span { color: var(--electric); display: block; font-size: 10px; letter-spacing: 0.25em; font-weight: 400; }
.login-box h2 { font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 800; margin-bottom: 8px; }
.login-box p { font-size: 14px; color: var(--muted); margin-bottom: 36px; line-height: 1.5; }
.field-group { margin-bottom: 20px; }
.field-group label { display: block; font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; font-weight: 500; }
.field-group input, .field-group select, .field-group textarea {
  width: 100%; background: rgba(255,255,255,0.04); border: 1px solid var(--border);
  border-radius: 4px; padding: 13px 16px; color: var(--white);
  font-family: 'DM Sans', sans-serif; font-size: 14px; outline: none;
  transition: border-color 0.3s;
}
.field-group input:focus, .field-group select:focus, .field-group textarea:focus { border-color: var(--electric); }
.field-group input::placeholder { color: var(--muted); }
.field-group select option { background: var(--deep); }
.btn { width: 100%; padding: 14px; border: none; border-radius: 4px; font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.3s; }
.btn-primary { background: var(--electric); color: var(--void); }
.btn-primary:hover { background: #fff; transform: translateY(-1px); }
.btn-ghost { background: transparent; color: var(--white); border: 1px solid var(--border); margin-top: 10px; }
.btn-ghost:hover { border-color: var(--electric); color: var(--electric); }
.btn-danger { background: rgba(255,68,102,0.15); color: var(--error); border: 1px solid rgba(255,68,102,0.3); }
.btn-danger:hover { background: rgba(255,68,102,0.25); }
.btn-success { background: rgba(0,255,136,0.15); color: var(--success); border: 1px solid rgba(0,255,136,0.3); }
.login-note { font-size: 12px; color: var(--muted); text-align: center; margin-top: 20px; line-height: 1.5; }
.login-note a { color: var(--electric); }
.error-msg { background: rgba(255,68,102,0.1); border: 1px solid rgba(255,68,102,0.3); border-radius: 4px; padding: 12px 16px; font-size: 13px; color: var(--error); margin-bottom: 20px; display: none; }
.error-msg.show { display: block; }

/* â”€â”€ SETUP HELPER â”€â”€ */
.setup-steps { margin-top: 20px; }
.setup-step { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); font-size: 13px; color: var(--muted); }
.setup-step:last-child { border-bottom: none; }
.step-num { color: var(--electric); font-weight: 700; font-family: 'Syne', sans-serif; flex-shrink: 0; }

/* â”€â”€ DASHBOARD â”€â”€ */
#dashScreen { flex-direction: column; }
.topbar {
  height: 64px; display: flex; align-items: center; justify-content: space-between;
  padding: 0 32px; border-bottom: 1px solid var(--border);
  background: rgba(4,12,20,0.9); backdrop-filter: blur(20px);
  position: sticky; top: 0; z-index: 100;
}
.topbar-logo { display: flex; align-items: center; gap: 10px; }
.topbar-logo img { height: 30px; }
.topbar-title { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; }
.topbar-title span { color: var(--electric); }
.topbar-right { display: flex; align-items: center; gap: 16px; }
.topbar-user { font-size: 12px; color: var(--muted); }
.topbar-btn { padding: 8px 18px; border-radius: 4px; font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.3s; border: none; }
.topbar-new { background: var(--electric); color: var(--void); }
.topbar-new:hover { background: #fff; }
.topbar-logout { background: transparent; color: var(--muted); border: 1px solid var(--border); }
.topbar-logout:hover { color: var(--white); border-color: rgba(255,255,255,0.3); }

.dash-body { display: flex; flex: 1; }
.sidebar {
  width: 260px; flex-shrink: 0; border-right: 1px solid var(--border);
  padding: 32px 24px; background: rgba(4,12,20,0.5);
}
.sidebar h3 { font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 16px; }
.article-list { display: flex; flex-direction: column; gap: 8px; }
.article-item {
  padding: 14px 16px; border: 1px solid var(--border); border-radius: 4px;
  cursor: pointer; transition: all 0.2s; background: rgba(0,212,255,0.01);
}
.article-item:hover { border-color: rgba(0,212,255,0.3); background: rgba(0,212,255,0.05); }
.article-item.active { border-color: var(--electric); background: rgba(0,212,255,0.08); }
.article-item-title { font-size: 13px; font-weight: 500; margin-bottom: 4px; line-height: 1.3; }
.article-item-meta { font-size: 11px; color: var(--muted); display: flex; gap: 8px; }
.article-tag { padding: 2px 6px; border-radius: 2px; background: rgba(0,212,255,0.1); color: var(--electric); font-size: 10px; letter-spacing: 0.08em; }
.empty-state { text-align: center; padding: 40px 20px; }
.empty-state .e-icon { font-size: 32px; margin-bottom: 12px; }
.empty-state p { font-size: 13px; color: var(--muted); line-height: 1.5; }

.main-panel { flex: 1; padding: 40px; overflow-y: auto; max-height: calc(100vh - 64px); }

/* â”€â”€ WELCOME â”€â”€ */
.welcome-panel { max-width: 600px; }
.welcome-panel h2 { font-family: 'Syne', sans-serif; font-size: 32px; font-weight: 800; margin-bottom: 12px; }
.welcome-panel h2 span { background: linear-gradient(90deg,var(--electric),var(--plasma)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.welcome-panel p { font-size: 15px; color: var(--muted); line-height: 1.7; margin-bottom: 32px; }
.stat-row { display: flex; gap: 20px; margin-bottom: 40px; }
.stat-box { flex: 1; padding: 24px; border: 1px solid var(--border); border-radius: 4px; background: rgba(0,212,255,0.02); }
.stat-box .s-num { font-family: 'Syne', sans-serif; font-size: 36px; font-weight: 800; color: var(--electric); }
.stat-box .s-label { font-size: 12px; color: var(--muted); margin-top: 4px; letter-spacing: 0.06em; }
.quick-actions { display: flex; flex-direction: column; gap: 12px; }
.quick-action { display: flex; align-items: center; gap: 16px; padding: 20px 24px; border: 1px solid var(--border); border-radius: 4px; cursor: pointer; transition: all 0.3s; background: rgba(0,212,255,0.01); text-decoration: none; color: inherit; }
.quick-action:hover { border-color: rgba(0,212,255,0.3); transform: translateX(4px); }
.qa-icon { font-size: 24px; }
.qa-text strong { display: block; font-size: 14px; margin-bottom: 2px; }
.qa-text span { font-size: 12px; color: var(--muted); }
.qa-arrow { margin-left: auto; color: var(--electric); font-size: 18px; }

/* â”€â”€ EDITOR â”€â”€ */
.editor-panel { max-width: 800px; }
.editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; flex-wrap: wrap; gap: 16px; }
.editor-header h2 { font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 800; }
.editor-actions { display: flex; gap: 10px; }
.e-btn { padding: 10px 22px; border-radius: 4px; font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.3s; border: none; }
.e-btn-save { background: var(--electric); color: var(--void); }
.e-btn-save:hover { background: #fff; }
.e-btn-delete { background: rgba(255,68,102,0.1); color: var(--error); border: 1px solid rgba(255,68,102,0.25); }
.e-btn-delete:hover { background: rgba(255,68,102,0.2); }
.e-btn-preview { background: rgba(0,212,255,0.1); color: var(--electric); border: 1px solid var(--border); }
.e-btn-preview:hover { background: rgba(0,212,255,0.15); }

.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.field-group textarea { resize: vertical; line-height: 1.6; }
.field-group .char-count { font-size: 11px; color: var(--muted); text-align: right; margin-top: 4px; }

.editor-toolbar {
  display: flex; gap: 8px; padding: 12px 16px; border: 1px solid var(--border);
  border-bottom: none; border-radius: 4px 4px 0 0;
  background: rgba(0,212,255,0.03); flex-wrap: wrap;
}
.toolbar-btn { padding: 6px 12px; border: 1px solid var(--border); border-radius: 3px; background: transparent; color: var(--muted); font-size: 12px; cursor: pointer; transition: all 0.2s; font-family: monospace; }
.toolbar-btn:hover { border-color: var(--electric); color: var(--electric); background: rgba(0,212,255,0.05); }
#bodyEditor {
  width: 100%; min-height: 400px; background: rgba(255,255,255,0.03);
  border: 1px solid var(--border); border-radius: 0 0 4px 4px;
  padding: 20px; color: var(--white); font-family: 'DM Sans', sans-serif;
  font-size: 15px; line-height: 1.8; outline: none; resize: vertical;
  transition: border-color 0.3s;
}
#bodyEditor:focus { border-color: var(--electric); }

.save-status {
  display: flex; align-items: center; gap: 8px; padding: 14px 20px;
  border-radius: 4px; margin-top: 20px; font-size: 14px;
  display: none;
}
.save-status.success { background: rgba(0,255,136,0.08); border: 1px solid rgba(0,255,136,0.25); color: var(--success); }
.save-status.error { background: rgba(255,68,102,0.08); border: 1px solid rgba(255,68,102,0.25); color: var(--error); }
.save-status.loading { background: rgba(0,212,255,0.08); border: 1px solid var(--border); color: var(--electric); }

/* â”€â”€ PREVIEW â”€â”€ */
.preview-overlay {
  display: none; position: fixed; inset: 0; z-index: 1000;
  background: var(--void); overflow-y: auto;
}
.preview-overlay.open { display: block; }
.preview-bar {
  position: sticky; top: 0; background: rgba(2,4,8,0.95); backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border); padding: 16px 32px;
  display: flex; justify-content: space-between; align-items: center; z-index: 10;
}
.preview-bar h4 { font-family: 'Syne', sans-serif; font-size: 13px; color: var(--muted); }
.preview-bar h4 span { color: var(--electric); }
.preview-close { padding: 8px 20px; background: var(--electric); color: var(--void); border: none; border-radius: 4px; font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; }
.preview-content { max-width: 760px; margin: 0 auto; padding: 60px 32px; }
.preview-tag { font-size: 11px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--electric); margin-bottom: 12px; }
.preview-title { font-family: 'Syne', sans-serif; font-size: 48px; font-weight: 800; line-height: 1.1; margin-bottom: 20px; letter-spacing: -0.02em; }
.preview-intro { font-size: 18px; color: var(--muted); line-height: 1.7; padding: 20px 0 20px 20px; border-left: 2px solid var(--electric); margin-bottom: 40px; }
.preview-body { font-size: 16px; line-height: 1.8; color: rgba(232,244,255,0.85); }
.preview-body h2 { font-family: 'Syne', sans-serif; font-size: 26px; font-weight: 700; margin: 48px 0 20px; color: var(--white); }
.preview-body h3 { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 600; margin: 36px 0 16px; color: var(--electric); }
.preview-body p { margin-bottom: 20px; }
.preview-body strong { color: var(--white); }
.preview-body ul, .preview-body ol { padding-left: 24px; margin-bottom: 20px; }
.preview-body li { margin-bottom: 8px; }
.preview-body blockquote { border-left: 2px solid var(--electric); padding: 16px 24px; margin: 24px 0; background: rgba(0,212,255,0.04); border-radius: 0 4px 4px 0; color: var(--muted); font-style: italic; }

/* â”€â”€ TOAST â”€â”€ */
.toast { position: fixed; bottom: 32px; right: 32px; padding: 16px 24px; border-radius: 4px; font-size: 14px; font-weight: 500; z-index: 9999; transform: translateY(100px); opacity: 0; transition: all 0.4s ease; pointer-events: none; }
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { background: rgba(0,255,136,0.15); border: 1px solid rgba(0,255,136,0.4); color: var(--success); }
.toast.error { background: rgba(255,68,102,0.15); border: 1px solid rgba(255,68,102,0.4); color: var(--error); }
.toast.info { background: rgba(0,212,255,0.15); border: 1px solid rgba(0,212,255,0.4); color: var(--electric); }

/* â”€â”€ LOADING SPINNER â”€â”€ */
.spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(0,212,255,0.2); border-top-color: var(--electric); border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

@media (max-width: 768px) {
  .dash-body { flex-direction: column; }
  .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border); padding: 20px; }
  .main-panel { padding: 24px; max-height: none; }
  .form-grid { grid-template-columns: 1fr; }
  .stat-row { flex-direction: column; }
  .editor-actions { flex-wrap: wrap; }
  .topbar { padding: 0 16px; }
}
</style>
</head>
<body>

<!-- â”€â”€ TOAST â”€â”€ -->
<div class="toast" id="toast"></div>

<!-- â”€â”€ PREVIEW OVERLAY â”€â”€ -->
<div class="preview-overlay" id="previewOverlay">
  <div class="preview-bar">
    <h4>Preview â€” <span>Live Article Look</span></h4>
    <button class="preview-close" onclick="closePreview()">âœ• Close Preview</button>
  </div>
  <div class="preview-content">
    <div class="preview-tag" id="previewTag"></div>
    <div class="preview-title" id="previewTitle"></div>
    <div class="preview-intro" id="previewIntro"></div>
    <div class="preview-body" id="previewBody"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- LOGIN SCREEN -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="loginScreen">
  <div class="login-box">
    <div class="login-logo">
      <img src="https://i.ibb.co/5hyxn26G/50212-666-375.png" alt="SMI">
      <div class="login-logo-text">Shine Masters<span>Blog Editor</span></div>
    </div>

    <div id="loginView">
      <h2>Welcome back</h2>
      <p>Log in with your GitHub Personal Access Token to manage your blog articles.</p>
      <div class="error-msg" id="loginError"></div>
      <div class="field-group">
        <label>GitHub Username</label>
        <input type="text" id="ghUsername" placeholder="your-github-username">
      </div>
      <div class="field-group">
        <label>GitHub Personal Access Token</label>
        <input type="password" id="ghToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
      </div>
      <div class="field-group">
        <label>Repository Name</label>
        <input type="text" id="ghRepo" placeholder="smi-website" value="smi-website">
      </div>
      <button class="btn btn-primary" onclick="login()">
        <span id="loginBtnText">Login to Editor â†’</span>
      </button>
      <button class="btn btn-ghost" onclick="showSetup()">How do I get a token?</button>
      <p class="login-note">Your token is stored only in your browser session and never sent anywhere except GitHub's API directly.</p>
    </div>

    <div id="setupView" style="display:none;">
      <h2>Get Your Token</h2>
      <p>A GitHub Personal Access Token lets this editor save articles directly to your repo. Takes 2 minutes.</p>
      <div class="setup-steps">
        <div class="setup-step"><span class="step-num">1</span><span>Go to <strong>github.com â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Tokens (classic)</strong></span></div>
        <div class="setup-step"><span class="step-num">2</span><span>Click <strong>"Generate new token (classic)"</strong></span></div>
        <div class="setup-step"><span class="step-num">3</span><span>Give it a name like <strong>"SMI Blog Editor"</strong></span></div>
        <div class="setup-step"><span class="step-num">4</span><span>Tick the <strong>"repo"</strong> checkbox (full repo access)</span></div>
        <div class="setup-step"><span class="step-num">5</span><span>Click <strong>"Generate token"</strong> and copy the token â€” it starts with <strong>ghp_</strong></span></div>
        <div class="setup-step"><span class="step-num">6</span><span>Paste it in the token field and log in</span></div>
      </div>
      <button class="btn btn-primary" style="margin-top:24px;" onclick="showLogin()">â† Back to Login</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- DASHBOARD SCREEN -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="dashScreen">
  <div class="topbar">
    <div class="topbar-logo">
      <img src="https://i.ibb.co/5hyxn26G/50212-666-375.png" alt="SMI">
      <div class="topbar-title">SMI <span>Blog Editor</span></div>
    </div>
    <div class="topbar-right">
      <span class="topbar-user" id="topbarUser"></span>
      <button class="topbar-btn topbar-new" onclick="newArticle()">+ New Article</button>
      <button class="topbar-btn topbar-logout" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="dash-body">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <h3>Articles (<span id="articleCount">0</span>)</h3>
      <div class="article-list" id="articleList">
        <div class="empty-state">
          <div class="e-icon">ğŸ“</div>
          <p>No articles yet.<br>Click "New Article" to write your first one.</p>
        </div>
      </div>
    </div>

    <!-- MAIN PANEL -->
    <div class="main-panel" id="mainPanel">

      <!-- WELCOME VIEW -->
      <div class="welcome-panel" id="welcomeView">
        <h2>Good to see you,<br><span id="welcomeName">Writer</span> ğŸ‘‹</h2>
        <p>This is your SMI blog command centre. Write new articles, edit existing ones, or preview how they'll look live â€” all without touching any code.</p>
        <div class="stat-row">
          <div class="stat-box">
            <div class="s-num" id="statArticles">0</div>
            <div class="s-label">Articles Published</div>
          </div>
          <div class="stat-box">
            <div class="s-num">8</div>
            <div class="s-label">Product Categories</div>
          </div>
          <div class="stat-box">
            <div class="s-num">âˆ</div>
            <div class="s-label">SEO Potential</div>
          </div>
        </div>
        <div class="quick-actions">
          <a class="quick-action" onclick="newArticle()">
            <div class="qa-icon">âœï¸</div>
            <div class="qa-text"><strong>Write New Article</strong><span>Start a fresh blog post from scratch</span></div>
            <div class="qa-arrow">â†’</div>
          </a>
          <a class="quick-action" href="https://shinemastersind.netlify.app/blog.html" target="_blank">
            <div class="qa-icon">ğŸŒ</div>
            <div class="qa-text"><strong>View Live Blog</strong><span>See your blog as visitors see it</span></div>
            <div class="qa-arrow">â†—</div>
          </a>
          <a class="quick-action" href="https://shinemastersind.netlify.app" target="_blank">
            <div class="qa-icon">ğŸ </div>
            <div class="qa-text"><strong>View Live Website</strong><span>Open the main SMI website</span></div>
            <div class="qa-arrow">â†—</div>
          </a>
        </div>
      </div>

      <!-- EDITOR VIEW -->
      <div class="editor-panel" id="editorView" style="display:none;">
        <div class="editor-header">
          <h2 id="editorHeading">New Article</h2>
          <div class="editor-actions">
            <button class="e-btn e-btn-preview" onclick="showPreview()">ğŸ‘ Preview</button>
            <button class="e-btn e-btn-delete" id="deleteBtn" onclick="deleteArticle()" style="display:none;">ğŸ—‘ Delete</button>
            <button class="e-btn e-btn-save" onclick="saveArticle()">
              <span id="saveBtnText">ğŸ’¾ Save & Publish</span>
            </button>
          </div>
        </div>

        <div class="form-grid">
          <div class="field-group" style="grid-column:1/-1;">
            <label>Article Title *</label>
            <input type="text" id="fTitle" placeholder="e.g. Why Rubber Seals Fail in Extreme Heat â€” And How to Prevent It">
          </div>
          <div class="field-group">
            <label>Category *</label>
            <select id="fCategory">
              <option value="bus-body">Bus Body Manufacturing</option>
              <option value="container">Container Logistics</option>
              <option value="procurement">Procurement Strategy</option>
              <option value="rubber">Rubber & PVC</option>
              <option value="automotive">Automotive</option>
              <option value="ev">EV & Future Tech</option>
            </select>
          </div>
          <div class="field-group">
            <label>Category Display Name *</label>
            <input type="text" id="fCategoryLabel" placeholder="e.g. Bus Body Manufacturing">
          </div>
          <div class="field-group">
            <label>Card Emoji (shown on blog listing)</label>
            <input type="text" id="fIcon" placeholder="ğŸšŒ" value="ğŸ­" maxlength="4">
          </div>
          <div class="field-group">
            <label>Read Time</label>
            <input type="text" id="fReadTime" placeholder="5 min read" value="5 min read">
          </div>
          <div class="field-group" style="grid-column:1/-1;">
            <label>Short Description (shown on blog card) *</label>
            <textarea id="fDesc" rows="2" placeholder="1-2 sentences that appear on the blog listing page..." oninput="updateCharCount(this, 'descCount')"></textarea>
            <div class="char-count"><span id="descCount">0</span> / 160 characters recommended</div>
          </div>
          <div class="field-group" style="grid-column:1/-1;">
            <label>Introduction Paragraph (bold intro at top of article) *</label>
            <textarea id="fIntro" rows="3" placeholder="A compelling 2-3 sentence intro that hooks the reader..."></textarea>
          </div>
        </div>

        <div class="field-group">
          <label>Article Body *</label>
          <div class="editor-toolbar">
            <button class="toolbar-btn" onclick="insertMd('## ', '')" title="Heading 2">H2</button>
            <button class="toolbar-btn" onclick="insertMd('### ', '')" title="Heading 3">H3</button>
            <button class="toolbar-btn" onclick="insertMd('**', '**')" title="Bold"><strong>B</strong></button>
            <button class="toolbar-btn" onclick="insertMd('*', '*')" title="Italic"><em>I</em></button>
            <button class="toolbar-btn" onclick="insertMd('\n- ', '')" title="Bullet list">â€¢ List</button>
            <button class="toolbar-btn" onclick="insertMd('\n> ', '')" title="Blockquote">" Quote</button>
            <button class="toolbar-btn" onclick="insertMd('\n---\n', '')" title="Divider">â€” Line</button>
            <button class="toolbar-btn" onclick="insertMd('[Link text](', ')')" title="Link">ğŸ”— Link</button>
          </div>
          <textarea id="bodyEditor" placeholder="Write your full article here...&#10;&#10;Use:&#10;## for headings&#10;**bold text**&#10;*italic text*&#10;- bullet points&#10;> blockquotes"></textarea>
        </div>

        <div class="save-status" id="saveStatus"></div>
      </div>

    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let GH_TOKEN = '';
let GH_USER = '';
let GH_REPO = '';
let articles = []; // { filename, title, category, categoryLabel, icon, readTime, desc, intro, body, sha }
let currentArticle = null; // index in articles array, or null for new

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSetup() {
  document.getElementById('loginView').style.display = 'none';
  document.getElementById('setupView').style.display = 'block';
}
function showLogin() {
  document.getElementById('loginView').style.display = 'block';
  document.getElementById('setupView').style.display = 'none';
}

async function login() {
  const username = document.getElementById('ghUsername').value.trim();
  const token = document.getElementById('ghToken').value.trim();
  const repo = document.getElementById('ghRepo').value.trim();
  const errEl = document.getElementById('loginError');
  const btnText = document.getElementById('loginBtnText');

  errEl.classList.remove('show');
  if (!username || !token || !repo) {
    errEl.textContent = 'Please fill in all fields.';
    errEl.classList.add('show');
    return;
  }

  btnText.innerHTML = '<span class="spinner"></span> Connecting...';

  try {
    // Verify token works
    const res = await ghFetch(`https://api.github.com/repos/${username}/${repo}`, token);
    if (!res.ok) {
      throw new Error(res.status === 401 ? 'Invalid token â€” please check and try again.' : `Repository "${repo}" not found or not accessible.`);
    }

    GH_TOKEN = token;
    GH_USER = username;
    GH_REPO = repo;

    sessionStorage.setItem('smi_token', token);
    sessionStorage.setItem('smi_user', username);
    sessionStorage.setItem('smi_repo', repo);

    await loadArticles();
    showDashboard();
  } catch(e) {
    errEl.textContent = e.message;
    errEl.classList.add('show');
    btnText.textContent = 'Login to Editor â†’';
  }
}

function logout() {
  sessionStorage.clear();
  GH_TOKEN = GH_USER = GH_REPO = '';
  articles = []; currentArticle = null;
  switchScreen('loginScreen');
  toast('Logged out successfully', 'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GITHUB API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ghFetch(url, token, options = {}) {
  return fetch(url, {
    ...options,
    headers: {
      'Authorization': `token ${token || GH_TOKEN}`,
      'Accept': 'application/vnd.github.v3+json',
      'Content-Type': 'application/json',
      ...(options.headers || {})
    }
  });
}

async function loadArticles() {
  articles = [];
  try {
    const res = await ghFetch(`https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/_posts`);
    if (res.status === 404) return; // folder doesn't exist yet
    const files = await res.json();
    if (!Array.isArray(files)) return;

    for (const file of files) {
      if (!file.name.endsWith('.json')) continue;
      const fileRes = await ghFetch(file.url);
      const fileData = await fileRes.json();
      const content = JSON.parse(atob(fileData.content));
      articles.push({ ...content, filename: file.name, sha: fileData.sha });
    }
  } catch(e) {
    console.warn('Could not load articles:', e);
  }
}

async function saveToGithub(filename, content, sha = null) {
  const body = {
    message: sha ? `Update article: ${filename}` : `Add article: ${filename}`,
    content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
  };
  if (sha) body.sha = sha;

  const res = await ghFetch(
    `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/_posts/${filename}`,
    GH_TOKEN,
    { method: 'PUT', body: JSON.stringify(body) }
  );
  if (!res.ok) {
    const err = await res.json();
    throw new Error(err.message || 'Failed to save');
  }
  return res.json();
}

async function deleteFromGithub(filename, sha) {
  const body = {
    message: `Delete article: ${filename}`,
    sha: sha
  };
  const res = await ghFetch(
    `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/_posts/${filename}`,
    GH_TOKEN,
    { method: 'DELETE', body: JSON.stringify(body) }
  );
  if (!res.ok) throw new Error('Failed to delete');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showDashboard() {
  switchScreen('dashScreen');
  document.getElementById('topbarUser').textContent = `@${GH_USER}`;
  document.getElementById('welcomeName').textContent = GH_USER;
  renderSidebar();
  showWelcome();
}

function renderSidebar() {
  const list = document.getElementById('articleList');
  const count = document.getElementById('articleCount');
  const stat = document.getElementById('statArticles');
  count.textContent = articles.length;
  stat.textContent = articles.length;

  if (articles.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="e-icon">ğŸ“</div><p>No articles yet.<br>Click "New Article" to write your first one.</p></div>`;
    return;
  }

  list.innerHTML = articles.map((a, i) => `
    <div class="article-item ${currentArticle === i ? 'active' : ''}" onclick="editArticle(${i})">
      <div class="article-item-title">${a.title || 'Untitled'}</div>
      <div class="article-item-meta">
        <span class="article-tag">${a.categoryLabel || a.category || 'Uncategorised'}</span>
        <span>${a.readTime || ''}</span>
      </div>
    </div>
  `).join('');
}

function showWelcome() {
  currentArticle = null;
  document.getElementById('welcomeView').style.display = 'block';
  document.getElementById('editorView').style.display = 'none';
  renderSidebar();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function newArticle() {
  currentArticle = null;
  document.getElementById('editorHeading').textContent = 'New Article';
  document.getElementById('deleteBtn').style.display = 'none';
  clearEditor();
  showEditor();
}

function editArticle(index) {
  currentArticle = index;
  const a = articles[index];
  document.getElementById('editorHeading').textContent = 'Edit Article';
  document.getElementById('deleteBtn').style.display = 'inline-block';

  document.getElementById('fTitle').value = a.title || '';
  document.getElementById('fCategory').value = a.category || 'bus-body';
  document.getElementById('fCategoryLabel').value = a.categoryLabel || '';
  document.getElementById('fIcon').value = a.icon || 'ğŸ­';
  document.getElementById('fReadTime').value = a.readTime || '5 min read';
  document.getElementById('fDesc').value = a.desc || '';
  document.getElementById('fIntro').value = a.intro || '';
  document.getElementById('bodyEditor').value = a.body || '';
  updateCharCount(document.getElementById('fDesc'), 'descCount');

  showEditor();
}

function clearEditor() {
  ['fTitle','fCategoryLabel','fDesc','fIntro','bodyEditor'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('fCategory').value = 'bus-body';
  document.getElementById('fIcon').value = 'ğŸ­';
  document.getElementById('fReadTime').value = '5 min read';
  document.getElementById('descCount').textContent = '0';
}

function showEditor() {
  document.getElementById('welcomeView').style.display = 'none';
  document.getElementById('editorView').style.display = 'block';
  document.getElementById('saveStatus').style.display = 'none';
  renderSidebar();
  document.getElementById('fTitle').focus();
}

function updateCharCount(el, countId) {
  document.getElementById(countId).textContent = el.value.length;
}

function insertMd(before, after) {
  const ta = document.getElementById('bodyEditor');
  const start = ta.selectionStart;
  const end = ta.selectionEnd;
  const selected = ta.value.substring(start, end);
  ta.value = ta.value.substring(0, start) + before + selected + after + ta.value.substring(end);
  ta.focus();
  ta.selectionStart = start + before.length;
  ta.selectionEnd = start + before.length + selected.length;
}

async function saveArticle() {
  const title = document.getElementById('fTitle').value.trim();
  const category = document.getElementById('fCategory').value;
  const categoryLabel = document.getElementById('fCategoryLabel').value.trim();
  const icon = document.getElementById('fIcon').value.trim();
  const readTime = document.getElementById('fReadTime').value.trim();
  const desc = document.getElementById('fDesc').value.trim();
  const intro = document.getElementById('fIntro').value.trim();
  const body = document.getElementById('bodyEditor').value.trim();

  if (!title || !desc || !intro || !body) {
    toast('Please fill in Title, Description, Introduction and Body', 'error');
    return;
  }

  const statusEl = document.getElementById('saveStatus');
  const btnText = document.getElementById('saveBtnText');
  statusEl.className = 'save-status loading';
  statusEl.innerHTML = '<span class="spinner"></span> &nbsp; Saving to GitHub...';
  statusEl.style.display = 'flex';
  btnText.innerHTML = '<span class="spinner"></span>';

  try {
    const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    const filename = currentArticle !== null ? articles[currentArticle].filename : `${slug}.json`;
    const sha = currentArticle !== null ? articles[currentArticle].sha : null;
    const date = new Date().toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' });

    const content = { title, category, categoryLabel, icon, readTime, desc, intro, body, date, slug };
    const result = await saveToGithub(filename, content, sha);

    // Update local state
    const saved = { ...content, filename, sha: result.content.sha };
    if (currentArticle !== null) {
      articles[currentArticle] = saved;
    } else {
      articles.unshift(saved);
      currentArticle = 0;
    }

    document.getElementById('deleteBtn').style.display = 'inline-block';
    document.getElementById('editorHeading').textContent = 'Edit Article';

    statusEl.className = 'save-status success';
    statusEl.innerHTML = 'âœ… &nbsp; Article saved and published to GitHub! Netlify will redeploy in ~30 seconds.';
    toast('Article saved successfully!', 'success');
    renderSidebar();
  } catch(e) {
    statusEl.className = 'save-status error';
    statusEl.innerHTML = `âŒ &nbsp; Error: ${e.message}`;
    toast('Save failed â€” ' + e.message, 'error');
  }

  btnText.textContent = 'ğŸ’¾ Save & Publish';
}

async function deleteArticle() {
  if (currentArticle === null) return;
  const a = articles[currentArticle];
  if (!confirm(`Delete "${a.title}"? This cannot be undone.`)) return;

  const btnText = document.getElementById('saveBtnText');
  btnText.innerHTML = '<span class="spinner"></span>';

  try {
    await deleteFromGithub(a.filename, a.sha);
    articles.splice(currentArticle, 1);
    toast('Article deleted', 'info');
    showWelcome();
  } catch(e) {
    toast('Delete failed â€” ' + e.message, 'error');
    btnText.textContent = 'ğŸ’¾ Save & Publish';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PREVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPreview() {
  const title = document.getElementById('fTitle').value || 'Article Title';
  const categoryLabel = document.getElementById('fCategoryLabel').value || document.getElementById('fCategory').value;
  const intro = document.getElementById('fIntro').value || '';
  const body = document.getElementById('bodyEditor').value || '';

  document.getElementById('previewTag').textContent = categoryLabel;
  document.getElementById('previewTitle').textContent = title;
  document.getElementById('previewIntro').textContent = intro;
  document.getElementById('previewBody').innerHTML = renderMarkdown(body);
  document.getElementById('previewOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closePreview() {
  document.getElementById('previewOverlay').classList.remove('open');
  document.body.style.overflow = '';
}

function renderMarkdown(text) {
  return text
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h2>$1</h2>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>')
    .replace(/^- (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>')
    .replace(/^(?!<[hbul]).+$/gm, p => p.trim() ? `<p>${p}</p>` : '')
    .replace(/---/g, '<hr style="border:none;border-top:1px solid rgba(0,212,255,0.15);margin:32px 0;">')
    .replace(/\n{3,}/g, '\n\n');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function toast(msg, type = 'info') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.classList.remove('show'), 3500);
}

// Auto-fill category label when category changes
document.getElementById && document.addEventListener('DOMContentLoaded', () => {
  const catMap = {
    'bus-body': 'Bus Body Manufacturing',
    'container': 'Container Logistics',
    'procurement': 'Procurement Strategy',
    'rubber': 'Rubber & PVC',
    'automotive': 'Automotive',
    'ev': 'EV & Future Tech'
  };
  const catSel = document.getElementById('fCategory');
  const catLabel = document.getElementById('fCategoryLabel');
  if (catSel && catLabel) {
    catSel.addEventListener('change', () => {
      if (!catLabel.value || Object.values(catMap).includes(catLabel.value)) {
        catLabel.value = catMap[catSel.value] || '';
      }
    });
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT â€” check session storage for saved credentials
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(async function init() {
  const token = sessionStorage.getItem('smi_token');
  const user = sessionStorage.getItem('smi_user');
  const repo = sessionStorage.getItem('smi_repo');
  if (token && user && repo) {
    GH_TOKEN = token; GH_USER = user; GH_REPO = repo;
    document.getElementById('ghUsername').value = user;
    document.getElementById('ghToken').value = token;
    document.getElementById('ghRepo').value = repo;
    try {
      await loadArticles();
      showDashboard();
    } catch(e) {
      sessionStorage.clear();
    }
  }
})();
</script>
</body>
</html>
